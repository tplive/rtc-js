<!DOCTYPE html>
<html>
<style>
pre {
  background-color: lightgrey;
}
</style>
<body>
<script>
window.onerror = function(errorMsg, url, lineNumber){
    // any action you want goes here
    // errorMsg is the error message itself.
    // url should be the file presenting the error, though i have
    //    found that it only presents to me the address of the site.
    // lineNumber is the line number the error occoured on.
    // here is an example of what you could do with it:
    const error = document.getElementById("error")
    error.innerHTML = "Error in " + url + " at " + lineNumber + ":\n" + errorMsg
}
</script>

<h1>Test Runner</h1>

<p id="perf"></p>
<h2>Testing Tuple functions</h2>
<ul id="test_list"></ul>

<h2>Testing Color functions</h2>
<ul id="colors_list"></ul>

<h2>Testing Canvas functions</h2>
<ul id="canvas_list"></ul>

<h2>Testing Matrix functions</h2>
<ul id="matrix_list"></ul>

<pre><code id="error"></code></pre>

<script src="js/functions.js"></script>
<script src="js/tests.js"></script>
<script>
// *** RUN TESTS, DISPLAY RESULTS

const start = performance.now()


function runTest(domId, callback) {
  
  // Get list and create a new list item
  const ul = document.getElementById(domId)
  const li = document.createElement("li")
  
  // Create placeholder inside list item
  const li_text = document.createElement("span")
  li_text.innerHTML = "Running " + callback.name + "(): "
  
  // Append list item to list
  ul.appendChild(li);
  // Append span to list item
  li.appendChild(li_text)
  
  // Run test
  var result = callback()
  
  const li_result = document.createElement("span")
  li.appendChild(li_result)
  var text = (result) ? "Test Passed!":"Test Failed!"
  var color = (result) ? "green":"red"
  li_result.innerHTML = text
  li_result.style.color = color

}

runTest("test_list", test_tuple_function)
runTest("test_list", test_vector_function)
runTest("test_list", test_point_function)
runTest("test_list", test_equal_function)
runTest("test_list", test_equal_tuples_function)
runTest("test_list", test_add_tuples_function)
runTest("test_list", test_subtract_tuples_function)
runTest("test_list", test_negate_tuple_function)
runTest("test_list", test_multiply_vector_function)
runTest("test_list", test_divide_vector_function)
runTest("test_list", test_magnitude_function)
runTest("test_list", test_normalize_function)
runTest("test_list", test_dot_function)
runTest("test_list", test_cross_function)

runTest("colors_list", test_color_function)
runTest("colors_list", test_add_colors_function)
runTest("colors_list", test_subtract_colors_function)
runTest("colors_list", test_multiply_color_function)
runTest("colors_list", test_multiply_colors_function)
runTest("colors_list", test_scale_color_function)

runTest("canvas_list", test_canvas_function)
runTest("canvas_list", test_html_canvas_function)
runTest("canvas_list", test_write_pixel_function)
runTest("canvas_list", test_catch_canvas_out_of_bounds)
runTest("canvas_list", test_constructing_ppm_header)
runTest("canvas_list", test_ppm_pixel_data)
runTest("canvas_list", test_canvas_to_ppm_function)

runTest("matrix_list", test_create_matrix_function)
runTest("matrix_list", test_matrix_equal_function)
runTest("matrix_list", test_multiply_matrices_function)
runTest("matrix_list", test_multiply_matrix_by_tuple_function)
runTest("matrix_list", test_multiply_by_identity_matrix_function)
runTest("matrix_list", test_transpose_matrix_function)
runTest("matrix_list", test_transpose_identity_matrix)
runTest("matrix_list", test_calculate_determinant_of_2x2_matrix)
runTest("matrix_list", test_submatrix_function)
runTest("matrix_list", test_minor_function)
runTest("matrix_list", test_cofactor_function)


const end = performance.now()
const elapsed = end - start

const cumulated = localStorage.getItem("test_running_time")
const runs = localStorage.getItem("runs")

localStorage.setItem("runs", Number(runs) + 1)
localStorage.setItem("test_running_time", Number(cumulated) + elapsed)

log("perf", "Tests running time: " + Math.round(elapsed) + " ms.")
log("perf", "Average running time: " + (cumulated / runs).toFixed(4) + " ms.")
</script>

</body>

</html>